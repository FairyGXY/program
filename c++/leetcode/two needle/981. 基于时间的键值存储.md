# [981. åŸºäºæ—¶é—´çš„é”®å€¼å­˜å‚¨](https://leetcode.cn/problems/time-based-key-value-store/description/)

è®¾è®¡ä¸€ä¸ªåŸºäºæ—¶é—´çš„é”®å€¼æ•°æ®ç»“æ„ï¼Œè¯¥ç»“æ„å¯ä»¥åœ¨ä¸åŒæ—¶é—´æˆ³å­˜å‚¨å¯¹åº”åŒä¸€ä¸ªé”®çš„å¤šä¸ªå€¼ï¼Œå¹¶é’ˆå¯¹ç‰¹å®šæ—¶é—´æˆ³æ£€ç´¢é”®å¯¹åº”çš„å€¼ã€‚

å®ç° TimeMap ç±»ï¼š

TimeMap() åˆå§‹åŒ–æ•°æ®ç»“æ„å¯¹è±¡  
void set(String key, String value, int timestamp) å­˜å‚¨ç»™å®šæ—¶é—´æˆ³ timestamp æ—¶çš„é”® key å’Œå€¼ valueã€‚  
String get(String key, int timestamp) è¿”å›ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼åœ¨ä¹‹å‰è°ƒç”¨äº† setï¼Œå…¶ä¸­ timestamp_prev <= timestamp ã€‚å¦‚æœæœ‰å¤šä¸ªè¿™æ ·çš„å€¼ï¼Œå®ƒå°†è¿”å›ä¸æœ€å¤§  timestamp_prev å…³è”çš„å€¼ã€‚å¦‚æœæ²¡æœ‰å€¼ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ã€‚  
 
ç¤ºä¾‹ 1ï¼š

è¾“å…¥ï¼š  
["TimeMap", "set", "get", "get", "set", "get", "get"]  
[[], ["foo", "bar", 1], ["foo", 1], ["foo", 3], ["foo", "bar2", 4], ["foo", 4], ["foo", 5]]  
è¾“å‡ºï¼š  
[null, null, "bar", "bar", null, "bar2", "bar2"]  

è§£é‡Šï¼š  
TimeMap timeMap = new TimeMap();  
timeMap.set("foo", "bar", 1);  // å­˜å‚¨é”® "foo" å’Œå€¼ "bar" ï¼Œæ—¶é—´æˆ³ timestamp = 1     
timeMap.get("foo", 1);         // è¿”å› "bar"  
timeMap.get("foo", 3);         // è¿”å› "bar", å› ä¸ºåœ¨æ—¶é—´æˆ³ 3 å’Œæ—¶é—´æˆ³ 2 å¤„æ²¡æœ‰å¯¹åº” "foo" çš„å€¼ï¼Œæ‰€ä»¥å”¯ä¸€çš„å€¼ä½äºæ—¶é—´æˆ³ 1 å¤„ï¼ˆå³ "bar"ï¼‰ ã€‚  
timeMap.set("foo", "bar2", 4); // å­˜å‚¨é”® "foo" å’Œå€¼ "bar2" ï¼Œæ—¶é—´æˆ³ timestamp = 4    
timeMap.get("foo", 4);         // è¿”å› "bar2"  
timeMap.get("foo", 5);         // è¿”å› "bar2"  
 

æç¤ºï¼š

1 <= key.length, value.length <= 100  
key å’Œ value ç”±å°å†™è‹±æ–‡å­—æ¯å’Œæ•°å­—ç»„æˆ  
1 <= timestamp <= 107  
set æ“ä½œä¸­çš„æ—¶é—´æˆ³ timestamp éƒ½æ˜¯ä¸¥æ ¼é€’å¢çš„  
æœ€å¤šè°ƒç”¨ set å’Œ get æ“ä½œ 2 * 105 æ¬¡  

## Think of thought

è¿™é“é¢˜çš„é¢˜æ„æ˜¯ï¼Œåœ¨æ¯æ¬¡è°ƒç”¨ set å‡½æ•°æ—¶ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œ key, value, timestamp , åœ¨è°ƒç”¨ get æ—¶ï¼Œä¼ å…¥ä¸¤ä¸ªå‚æ•° key, timestamp 

å¦‚æœä¹‹å‰è°ƒç”¨ set æ—¶å­˜æ”¾è¿‡ key çš„å€¼ï¼Œé‚£ä¹ˆå°±è¿”å›æœ€æ¥è¿‘ timestamp çš„ valueã€‚

å¦‚æœä¹‹å‰è°ƒç”¨ set æ—¶æ²¡æœ‰å­˜æ”¾è¿‡ key çš„å€¼ï¼Œé‚£ä¹ˆå°±è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚

é‚£ä¹ˆå°±å¯ä»¥ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ unordered_map<string, vector<pair<int, value>>> m æ¥å­˜æ”¾è°ƒç”¨ set æ—¶çš„æ•°æ®ã€‚ç„¶åç”¨ lower_bound å‡½æ•°æŸ¥æ‰¾å°±å¯ä»¥ã€‚

## Solution

```cpp
class TimeMap {
    unordered_map<string, vector<pair<int, string>>> m; // å­˜å‚¨ï¼škey -> (timestamp, value)
public:
    TimeMap() {
        // åˆå§‹åŒ–
    }
    
    void set(string key, string value, int timestamp) {
        // ä½¿ç”¨ vector å­˜å‚¨æ¯ä¸ª key ä¸‹çš„ timestamp -> value
        m[key].emplace_back(timestamp, value);
    }
    
    string get(string key, int timestamp) {
        // å¦‚æœ key ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›ç©ºå­—ç¬¦ä¸²
        if (m.find(key) == m.end()) {
            return "";
        }
        
        // è·å–æ‰€æœ‰ (timestamp, value) å¯¹åº”çš„ vector
        const vector<pair<int, string>>& items = m[key];
        
        // ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾å®šä½æ—¶é—´æˆ³å¯¹åº”çš„ä½ç½®
        auto it = upper_bound(items.begin(), items.end(), make_pair(timestamp, "kobe bryant"), 
                              [](const pair<int, string>& a, const pair<int, string>& b) {
                                  return a.first < b.first; // æ¯”è¾ƒ timestamp
                              });

        // å¦‚æœæ‰¾åˆ°çš„è¿­ä»£å™¨æŒ‡å‘å¼€å¤´ï¼Œåˆ™æ²¡æœ‰ä»»ä½• timestamp å°äºç­‰äºç»™å®šçš„å€¼
        if (it == items.begin()) return "";

        // è¿”å›æ‰¾åˆ°çš„ (timestamp, value) çš„å€¼
        return prev(it)->second;
    }
};
```
è¿™é‡Œåœ¨ set å‡½æ•°ä¸­ï¼Œä½¿ç”¨åˆ°äº† emplace_back() å‡½æ•°

![image](https://github.com/user-attachments/assets/278097fd-e0de-43c3-a350-094625bf0cc7)

![image](https://github.com/user-attachments/assets/fa2132cd-4755-4ea0-98ad-ae012a712d55)

![image](https://github.com/user-attachments/assets/a4d619d3-9e57-4e48-adf1-0c61ba9fae54)

åœ¨ get å‡½æ•°é‡Œï¼Œå…ˆåˆ¤æ–­ key æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œå®šä¹‰äº†ä¸€ä¸ª items æŒ‡å‘äº† m[key] çš„ vector çš„å®¹å™¨ï¼Œè¿™é‡Œçš„ items å®Œå…¨å¯ä»¥ç”¨ä¸€ä¸ª auto ç±»å‹ã€‚

**ä½†æ˜¯æ³¨æ„ä¸€å®šè¦åŠ ä¸Š & ï¼Œä¸ç„¶ä¼šçˆ†å†…å­˜ï¼**

![image](https://github.com/user-attachments/assets/5e5afbdb-1830-4447-b106-4100070fbe37)

è¿˜æœ‰ï¼Œæˆ‘ç”¨åˆ°äº† lambda è¡¨è¾¾å¼ï¼Œ

![image](https://github.com/user-attachments/assets/e335955d-498b-4306-98a4-73a812418d47)

![image](https://github.com/user-attachments/assets/961e7756-c9c8-4b2d-afe0-d1fdb6f52685)

è¿™é‡Œçš„ç¬¬ä¸‰ä¸ªå‚æ•° make_pair(timestamp, "kobe bryant") è¿™ä¸ªå°±æ˜¯æ»¡è¶³äº†ç±»å‹çš„è¦æ±‚ï¼Œä¸»è¦æ˜¯æŠŠ timestamp ä¼ å…¥è¿›å»å¥½åšæ¯”è¾ƒï¼Œåé¢çš„å­—ç¬¦ä¸²å°±æ— æ‰€è°“äº†ã€‚

è¦æ³¨æ„ï¼Œè¿™é‡Œçš„ lambda è¡¨è¾¾å¼æ‰¾åˆ°çš„å€¼æ˜¯ç¬¬ä¸€ä¸ª > timestamp çš„è¿­ä»£å™¨ï¼Œè€Œæˆ‘ä»¬è¦æ‰¾çš„æ˜¯ç¬¬ä¸€ä¸ª <= timestamp çš„è¿­ä»£å™¨çš„ï¼Œæ‰€ä»¥æœ€åç”¨åˆ°äº† prev(it) æ˜¯è¿­ä»£å™¨ it çš„ä¸Šä¸€ä¸ªè¿­ä»£å™¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„è¿­ä»£å™¨ï¼Œç„¶åè¿”å› it -> second

## Summary

æ€»ä¹‹æ¥è¯´ï¼Œè¿™ä¸ªé¢˜çš„æ€è·¯è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å®ç°èµ·æ¥ä¸ç®€å•ï¼Œç”¨åˆ°äº†å¾ˆå¤šéƒ½æ²¡è§è¿‡çš„åº“å‡½æ•°ğŸ¥²ï¼Œè¿™ä¸€ç¯‡æ—¥è®°ä»¥åå¾—å¥½å¥½çœ‹çœ‹ã€‚
